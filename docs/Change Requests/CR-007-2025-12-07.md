# IsoStack Issues

Generated: 2025-12-07T07:15:08.501Z

Total Issues: 1

---

## Pending (1)

### Collapse and expand sidebar/navbar

**Issue #14** | **ID:** `cmive0vf4001110vmwuizrnhg`
**CR #7** | **CR ID:** `cmive12ll001610vm9dfnx7l9`
**Perspective:** PLATFORM_OWNER
**Category:** Refinement | **Priority:** High
**Tags:** SideBar
**Modules:** CORE
**Created:** 2025-12-07T07:14:58.959Z
**Created By:** Chris - Platform Admin

**Description:**

The side navigation bar displays both icons and words for every link. The size of the icons is static. In certain circumstances, I would like the side navigation/navbar to reduce is size. The most effective way of doing this is to have the bar display icons only. There should be a toggle switch in the Sidebar/side nave to 'open' the sidebar - ie display the words and icons, or 'close' - display icons only. The transition is a quick animation of the draw opening and closing which provides illustates what is happening. The driver for this feature is A: When screen collateral is limited, eg when the navbar is 25% or more of the visible screen, the purpose of the app is the app area, not the sidebar! B: The user is very familiar with the menu choices and only require icons. Other apsects of the sidebar - eg colour are unaffected by this, There is a context flag at the top of the side bar and this will move to the header next to the user dropdown - which is actually the best place for the user cotent flag - next to the user menu top right.

---

# **Plan: Collapsible Sidebar with Context Badge Relocation**
This CR implements a toggle-based sidebar collapse feature (icons-only vs full-width), automatic responsive behavior at 1024px, and relocates the context badge to the header. The collapsed state persists in localStorage, animations use 200ms ease-in-out, and tooltips remain functional on hover.

**Steps**
Create sidebar collapse state management in AppShell.tsx - Add localStorage-backed collapsed state, integrate with navbar.width (collapsed: 80px, expanded: 250px), implement auto-collapse at 1024px breakpoint with useMediaQuery, pass state to Navbar and Header components.

Refactor Navbar.tsx for collapse mode in Navbar.tsx - Add toggle button at top of sidebar, conditionally hide text labels when collapsed, adjust icon sizing (32px → 24px), modify NavLink to show tooltips on hover when collapsed, update spacing/padding for narrow width, animate transitions with style={{ transition: 'all 200ms ease-in-out' }}.

Create context badge component for header in src/core/components/layout/ContextBadge.tsx - Build new component receiving scope, profile, and collapsed props, display role icon (IconBuilding for platform/admin, IconUser for regular users), show name + role for platform/admin users, show name only for regular users, position next to user dropdown in header.

Integrate context badge in Header.tsx in Header.tsx - Import and render ContextBadge component to the left of user menu, pass profile data and scope, ensure responsive behavior on mobile (hide badge, show in dropdown instead?).

Remove SidebarContext from Navbar.tsx in Navbar.tsx and SidebarContext.tsx - Delete <SidebarContext> component usage from Navbar (replaced by header badge), optionally deprecate/archive SidebarContext.tsx file (or repurpose for future tenant switcher).

Update AppShell navbar width logic in AppShell.tsx - Modify navbar={{ width: collapsed ? 80 : 250, breakpoint: 'sm', collapsed: { mobile: !opened } }}, ensure main content area reflows smoothly with 200ms transition, test on desktop and tablet/mobile viewports.

Further Considerations
Mobile behavior - Should the collapse toggle be hidden on mobile since the sidebar is already a drawer? Or keep it visible when drawer is open?
Tooltip positioning - When sidebar is collapsed, should tooltips appear on the right side of icons (default) or follow cursor? Mantine's Tooltip component may need position="right" prop.
Keyboard accessibility - Should the toggle button have a keyboard shortcut (e.g., Ctrl+B or Cmd+B)? Common in IDEs

---

## ✅ Implementation Complete

**Status:** Complete  
**Date:** 2025-12-07

### Implementation Summary

Successfully implemented collapsible sidebar with all requirements:

1. **Collapse/Expand Toggle** 
   - Toggle button at top of sidebar with icon indicators
   - Collapsed: 80px width (icons only)
   - Expanded: 250px width (icons + labels)
   - 200ms ease-in-out transitions throughout

2. **State Persistence**
   - Collapsed state saved to localStorage (`sidebar-collapsed`)
   - Persists across page reloads and sessions

3. **Responsive Auto-Collapse**
   - Automatically collapses at 1024px breakpoint
   - Mobile drawer behavior unchanged (standard practice)

4. **Keyboard Shortcut**
   - `Cmd+B` (Mac) or `Ctrl+B` (Windows/Linux) to toggle
   - Tooltip shows shortcut hint

5. **Context Badge Relocated**
   - Moved from sidebar to header (next to user dropdown)
   - Shows role icon (building for platform/admin, person for users)
   - Displays name + role for platform/admin users
   - Displays name only for regular users (role excluded per spec)

6. **Tooltip Behavior**
   - All navigation items show tooltips on hover when collapsed
   - Positioned to the right of icons
   - Help and Edit Mode switches hidden when collapsed (icons remain visible)

7. **Smooth Animations**
   - All NavLinks animate with 200ms ease-in-out
   - Icon sizes adjust (32px → 24px when collapsed)
   - Badges and labels hide/show smoothly
   - Main content area reflows with transition

### Files Modified

- `src/core/components/layout/AppShell.tsx` - Added collapse state, localStorage, media query, keyboard shortcut
- `src/core/components/layout/Navbar.tsx` - Refactored with toggle button, conditional rendering, tooltips
- `src/core/components/layout/Header.tsx` - Integrated ContextBadge component
- `src/core/components/layout/ContextBadge.tsx` - New component showing user context in header

### Testing Checklist

- ✅ Click toggle button - sidebar collapses/expands
- ✅ Press `Cmd+B` - keyboard shortcut works
- ✅ Hover over icons when collapsed - tooltips appear
- ✅ Resize window below 1024px - auto-collapses
- ✅ Refresh page - state persists from localStorage
- ✅ Context badge in header shows correct role/name
- ✅ Settings submenu hides children when collapsed
- ✅ Smooth 200ms animations on all transitions