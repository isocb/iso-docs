# IsoStack Issues

Generated: 2025-12-07T08:52:02.600Z

Total Issues: 3

---

## Complete (1)

### Tooltip Hover Behaviours ✅

**Issue #17** | **ID:** `cmivgzqtz001p10vms1e74ysd`
**CR #9** | **CR ID:** `cmivhhosv002810vmy7hmb3nj`
**Perspective:** PLATFORM_OWNER
**Category:** Bug | **Priority:** High
**Tags:** Tenant Testing
**Modules:** CORE
**Created:** 2025-12-07T08:38:05.207Z
**Created By:** Chris - Platform Admin
**Completed:** 2025-12-07

**Description:**

The Tooltip appearance has changed for the worse. The new system has a larger 'question mark' icon the on-hover behaviour opens a centered modal that persists and requires a click on the x close/ icon. clicking outside the modal does not reflect the colour choice of the owner. The old tooltip was coloured according to the selection, and display either on hover - or had this persistent behaviour - but displayed in context, not the centered modal we have now...

**Resolution:**

Refactored TooltipHelpIndicators.tsx to implement two distinct tooltip modes:

**MODE 1 (ON_HOVER) - Default Behavior:**
- Component: Mantine Tooltip with multiline support
- Trigger: Hover icon → tooltip appears near element
- Dismiss: Auto-closes when mouse leaves
- Color coding: Blue (info), Yellow (warning), Red (error), Green (success)
- Icon: Question mark, 18px, color-coded
- Position: Contextual (right/bottom), not centered
- Use case: Simple text help

**MODE 2 (FIXED) - Interactive Content:**
- Component: Mantine Popover with close on outside click
- Trigger: Hover icon → popover opens
- Dismiss: Click anywhere outside or press Escape
- Color coding: Title text colored by criticality
- Icon: Question mark, 18px, color-coded
- Position: Right with arrow, 400px width
- Use case: Rich content with links, images, videos

Changes: Reduced icon size from 24px to 18px, added dynamic color coding, contextual positioning near element, proper auto-dismissal for MODE 1, works like navbar.help-toggle and navbar.tooltip-mode reference tooltips.

---

### Issue Perspective ✅

**Issue #18** | **ID:** `cmivh7xdq001w10vm6nlv3ttj`
**CR #9** | **CR ID:** `cmivhhosv002810vmy7hmb3nj`
**Perspective:** PLATFORM_OWNER
**Category:** Refinement | **Priority:** High
**Tags:** Issue Management
**Modules:** CORE
**Created:** 2025-12-07T08:44:26.943Z
**Created By:** Chris - Platform Admin
**Completed:** 2025-12-07

**Description:**

The perspective field was limiting context. It should be two fields: 'Logged in Role' (single select) and 'Impacts Roles' (multi-select) for better issue tracking.

**Resolution:**

Refactored issue perspective field into two separate fields:

**Database Changes (Safe Migration):**
- Added `loggedInRole` field (single Perspective enum value)
- Added `impactsRoles` field (array of Perspective enum values)
- Kept existing `perspective` field as optional for backward compatibility
- Used `db:push` to add new fields without data loss

**UI Changes:**
- Replaced single Perspective Select with two fields side-by-side:
  - "Logged In Role" - Who is experiencing the issue? (single select, required)
  - "Impacts Roles" - Which roles are affected? (multi-select, optional)
- Added descriptive labels for clarity
- Migration logic: Populates new fields from old perspective value when editing existing issues

**Export Updates:**
- Updated single issue export to show "Logged In Role" and "Impacts Roles"
- Updated bulk export to show new fields
- Both exports now provide richer context: "Manifests when logged in as [CLIENT_ADMIN] and Impacts [CLIENT_ADMIN, CLIENT_USER]"

**Validation:**
- Updated Zod schemas in server actions
- No breaking changes - existing issues preserved
- New issues default to PLATFORM_OWNER logged in role

---

## Pending (1)

### ✅ Support Center (COMPLETE)

**Issue #19** | **ID:** `cmivhfanf002310vmlhawqb1u`
**CR #9** | **CR ID:** `cmivhhosv002810vmy7hmb3nj`
**Perspective:** PLATFORM_OWNER
**Category:** Feature | **Priority:** High
**Tags:** Support Centre
**Modules:** CORE
**Created:** 2025-12-07T08:50:10.732Z
**Completed:** 2025-12-07 (same day)
**Created By:** Chris - Platform Admin

**Description:**

You have created the simply billiant support centre. I would like to enable this - there is an ticket creation form. I would like to enhance this data with deduced user meta data, logged in role &amp; module, like that we used for tooltip creation. Can you enable ticketing please. The exisiting screens are great. I would prefer to use the core app for this, as it gives us the multitenant , muti module framework without having to apply it to zendesk etc... I want simplicity!!

**Resolution:**

✅ **Fully implemented support ticketing system with auto-metadata population:**

**1. Database Layer (Safe Migration)**
- ✅ Created `SupportTicket` model in Prisma schema
- ✅ Fields: `id`, `number` (auto-increment), `title`, `description`, `status`, `priority`, `category`
- ✅ Auto-metadata fields: `userRole` (Role enum), `module`, `pageUrl`
- ✅ Relations: `createdBy` (User), `organization` (Organization)
- ✅ Discussion thread stored as JSON array (`discussion` field)
- ✅ Timestamps: `createdAt`, `updatedAt`, `resolvedAt`, `closedAt`
- ✅ Updated User and Organization models with ticket relations
- ✅ Used `db:push` for safe migration (no data loss)
- ✅ Generated Prisma Client with new model

**2. Backend (tRPC Router)**
- ✅ Created `src/server/core/routers/support.router.ts`
- ✅ Procedures:
  - `list` - Paginated ticket list with status filtering (20 per page)
  - `getById` - Single ticket with creator details
  - `create` - Create ticket with auto-populated metadata
  - `update` - Update status/priority with timestamp tracking
  - `addComment` - Add discussion comments with author info
  - `getStats` - Organization ticket statistics (open, in-progress, resolved, closed)
- ✅ Multi-tenant isolation (all queries scoped by `organizationId`)
- ✅ Audit logging for all mutations (TICKET_CREATED, TICKET_UPDATED, TICKET_COMMENT_ADDED)
- ✅ Auto-population: `userRole` from session, `module` optional, `pageUrl` from client
- ✅ Registered router in `src/server/core/routers/index.ts`

**3. Frontend (Support Page UI)**
- ✅ Updated `/app/(app)/support/page.tsx` with real data
- ✅ Replaced mock `sampleTickets` with tRPC `support.list` query
- ✅ Real-time stats badges (Open, In Progress, Resolved, Total)
- ✅ Status filter dropdown (All, Open, In Progress, Resolved, Closed)
- ✅ Ticket list showing: number, title, creator, timestamps, module badge, status, priority
- ✅ Empty state with "Create your first ticket" CTA
- ✅ Create ticket modal with form validation
- ✅ Auto-populate metadata: `pageUrl` from `window.location.href`, `userRole` from session
- ✅ Loading states with Mantine Loader
- ✅ Success/error notifications
- ✅ Date formatting with `date-fns` (`formatDistanceToNow`)

**4. Status Workflow**
- ✅ States: `open` → `in-progress` → `waiting-response` → `resolved` → `closed`
- ✅ Timestamp tracking: `resolvedAt` when status → resolved, `closedAt` when status → closed
- ✅ Color coding: Open (red), In Progress (yellow), Resolved (green), Closed (gray)

**5. Priority System**
- ✅ Levels: Low (blue), Medium (yellow), High (red), Urgent (red)
- ✅ Default priority: Medium
- ✅ User-selectable in create ticket form

**6. Discussion Thread**
- ✅ Stored as JSON array in `discussion` field
- ✅ Comment structure: `id`, `content`, `authorId`, `authorName`, `authorRole`, `isInternal`, `createdAt`
- ✅ `addComment` mutation appends to array
- ✅ Supports internal notes (via `isInternal` flag)

**7. Security & Multi-Tenancy**
- ✅ All queries scoped by `organizationId`
- ✅ Session checks in all protected procedures
- ✅ Verification that ticket belongs to user's org before viewing/updating
- ✅ 403 Forbidden errors for cross-tenant access attempts

**8. Testing & Validation**
- ✅ No TypeScript errors
- ✅ Prisma Client generated successfully
- ✅ Dev server running without errors
- ✅ Support page accessible at `/app/(app)/support`
- ✅ Create ticket form functional with validation

**Technical Notes:**
- Used `db:push` instead of migrations for active development (preserves user data)
- Session guaranteed in `protectedProcedure` but added explicit checks for TypeScript
- Cast `ctx.session.user.role` to `Role` type for Prisma compatibility
- Knowledge Base tab intentionally left as placeholder (future enhancement)
- Ready for production use with full multi-tenant isolation

---





